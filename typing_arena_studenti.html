<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö° TYPING ARENA ‚ö°</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        body {
            background: #0a0e27;
            font-family: 'Press Start 2P', monospace;
            color: #00ff87;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15),
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 1000;
            animation: scanline 8s linear infinite;
        }

        @keyframes scanline {
            0% { transform: translateY(0); }
            100% { transform: translateY(10px); }
        }

        /* PIXEL ART MASCOT - ROBOT TYPIST */
        .mascot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            z-index: 999;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .robot {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .robot-head {
            width: 40px;
            height: 40px;
            background: #00ff87;
            position: absolute;
            top: 5px;
            left: 20px;
            box-shadow: 
                inset 0 0 0 4px #0a0e27,
                0 0 20px #00ff87;
        }

        .robot-eye {
            width: 8px;
            height: 8px;
            background: #ff006e;
            position: absolute;
            top: 12px;
            box-shadow: 0 0 10px #ff006e;
            animation: blink 3s infinite;
        }

        .robot-eye.left { left: 8px; }
        .robot-eye.right { right: 8px; }

        @keyframes blink {
            0%, 48%, 52%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        .robot-antenna {
            width: 4px;
            height: 12px;
            background: #ffbe0b;
            position: absolute;
            top: -8px;
            left: 18px;
            box-shadow: 0 0 10px #ffbe0b;
        }

        .robot-antenna::after {
            content: '';
            width: 8px;
            height: 8px;
            background: #ff006e;
            position: absolute;
            top: -6px;
            left: -2px;
            border-radius: 50%;
            box-shadow: 0 0 15px #ff006e;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }

        .robot-body {
            width: 48px;
            height: 32px;
            background: #00f5ff;
            position: absolute;
            top: 45px;
            left: 16px;
            box-shadow: 
                inset 0 0 0 4px #0a0e27,
                0 0 20px #00f5ff;
        }

        .robot-keyboard {
            width: 20px;
            height: 12px;
            background: #ffbe0b;
            position: absolute;
            bottom: 8px;
            left: 14px;
            box-shadow: inset 0 0 0 2px #0a0e27;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #1a0033 0%, #0a0e27 50%, #001a33 100%);
            border: 4px solid #ff006e;
            border-radius: 20px;
            box-shadow: 0 0 30px #ff006e, inset 0 0 30px rgba(255, 0, 110, 0.3);
            animation: borderPulse 2s ease-in-out infinite;
            position: relative;
        }

        header::before {
            content: 'üëæ';
            position: absolute;
            top: 15px;
            left: 20px;
            font-size: 2em;
            animation: float 2s ease-in-out infinite;
        }

        header::after {
            content: 'üëæ';
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2em;
            animation: float 2.5s ease-in-out infinite;
        }

        @keyframes borderPulse {
            0%, 100% { box-shadow: 0 0 30px #ff006e, inset 0 0 30px rgba(255, 0, 110, 0.3); }
            50% { box-shadow: 0 0 50px #ff006e, inset 0 0 50px rgba(255, 0, 110, 0.5); }
        }

        h1 {
            font-size: 2.5em;
            color: #00ff87;
            text-shadow: 
                4px 4px 0 #ff006e,
                0 0 20px #00ff87;
            margin-bottom: 20px;
        }

        .subtitle {
            font-size: 0.8em;
            color: #ffbe0b;
            text-shadow: 0 0 10px #ffbe0b;
        }

        .section-box {
            background: rgba(26, 26, 46, 0.8);
            border: 3px solid #00f5ff;
            border-radius: 0;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 
                8px 8px 0 rgba(0, 245, 255, 0.3),
                0 0 30px rgba(0, 245, 255, 0.3);
        }

        .section-title {
            font-size: 1em;
            color: #00ff87;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #00ff87;
            text-align: center;
        }

        .instructions ol {
            margin-left: 30px;
            line-height: 2.2;
            font-size: 0.65em;
            color: #00f5ff;
        }

        .instructions strong {
            color: #ffbe0b;
        }

        .instructions p {
            margin-top: 15px;
            font-size: 0.65em;
            color: #ff006e;
        }

        .level-legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 12px;
        }

        .level-item {
            padding: 15px;
            border-radius: 0;
            text-align: center;
            font-size: 0.6em;
            border: 3px solid;
            box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
        }

        .level-wanted { background: rgba(255, 107, 107, 0.2); border-color: #ff6b6b; color: #ff6b6b; }
        .level-newbie { background: rgba(160, 174, 192, 0.2); border-color: #a0aec0; color: #a0aec0; }
        .level-typist { background: rgba(72, 187, 120, 0.2); border-color: #48bb78; color: #48bb78; }
        .level-speedster { background: rgba(66, 153, 225, 0.2); border-color: #4299e1; color: #4299e1; }
        .level-advanced { background: rgba(159, 122, 234, 0.2); border-color: #9f7aea; color: #9f7aea; }
        .level-legend { background: rgba(237, 100, 166, 0.2); border-color: #ed64a6; color: #ed64a6; }
        .level-master { background: rgba(255, 215, 0, 0.2); border-color: #ffd700; color: #ffd700; animation: masterGlow 2s infinite; }

        @keyframes masterGlow {
            0%, 100% { box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3), 0 0 15px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3), 0 0 30px rgba(255, 215, 0, 0.8); }
        }

        #csvInput {
            width: 100%;
            height: 120px;
            background: #0a0e27;
            border: 2px solid #00f5ff;
            color: #00ff87;
            font-family: monospace;
            padding: 15px;
            border-radius: 0;
            font-size: 0.7em;
            resize: vertical;
        }

        .load-btn {
            width: 100%;
            padding: 15px;
            margin-top: 15px;
            background: linear-gradient(45deg, #ff006e, #fb5607);
            border: 3px solid #0a0e27;
            color: white;
            font-family: 'Press Start 2P';
            font-size: 0.7em;
            cursor: pointer;
            border-radius: 0;
            transition: all 0.3s;
            box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.5);
        }

        .load-btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.5);
        }

        .load-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.5);
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab {
            padding: 12px 20px;
            background: #1a1a2e;
            border: 3px solid #00f5ff;
            color: #00f5ff;
            cursor: pointer;
            font-size: 0.55em;
            border-radius: 0;
            transition: all 0.3s;
            box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.3);
        }

        .tab:hover {
            transform: translate(-2px, -2px);
            box-shadow: 5px 5px 0 rgba(0, 0, 0, 0.3);
        }

        .tab.active {
            background: #00f5ff;
            color: #0a0e27;
            border-color: #00ff87;
            transform: translate(-2px, -2px);
            box-shadow: 5px 5px 0 rgba(0, 245, 255, 0.6);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(26, 26, 46, 0.8);
            border: 3px solid #ff006e;
            border-radius: 0;
            padding: 20px;
            text-align: center;
            box-shadow: 
                6px 6px 0 rgba(255, 0, 110, 0.3),
                0 0 30px rgba(255, 0, 110, 0.4);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translate(-3px, -3px);
            box-shadow: 
                9px 9px 0 rgba(255, 0, 110, 0.3),
                0 10px 40px rgba(255, 0, 110, 0.6);
        }

        .stat-card-title {
            font-size: 0.55em;
            color: #ffbe0b;
            margin-bottom: 12px;
        }

        .stat-card-value {
            font-size: 2.2em;
            color: #00ff87;
            text-shadow: 0 0 10px #00ff87;
        }

        /* VERTICAL HISTOGRAM */
        .histogram-container {
            background: rgba(26, 26, 46, 0.9);
            border: 4px solid #fb5607;
            border-radius: 0;
            padding: 30px;
            box-shadow: 
                8px 8px 0 rgba(251, 86, 7, 0.3),
                0 0 50px rgba(251, 86, 7, 0.5);
            margin-bottom: 30px;
        }

        .histogram-title {
            font-size: 1.1em;
            color: #ffbe0b;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 0 10px #ffbe0b;
            padding-bottom: 15px;
            border-bottom: 3px solid #ffbe0b;
        }

        .histogram-grid {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 4px;
            height: 400px;
            padding: 20px;
            background: rgba(15, 52, 96, 0.3);
            border: 2px solid #00f5ff;
            position: relative;
            overflow-x: auto;
        }

        .histogram-bar-vertical {
            flex: 0 0 auto;
            width: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .histogram-bar-vertical:hover {
            transform: translateY(-5px);
        }

        .histogram-bar-fill-vertical {
            width: 100%;
            border-radius: 0;
            border: 2px solid #0a0e27;
            transition: height 1s ease-out;
            position: relative;
            box-shadow: 
                2px 0 0 rgba(0, 0, 0, 0.3),
                0 0 15px;
        }

        .histogram-bar-wanted { background: linear-gradient(0deg, #ff6b6b, #ee5a6f); box-shadow: 0 0 15px #ff6b6b; }
        .histogram-bar-newbie { background: linear-gradient(0deg, #a0aec0, #cbd5e0); box-shadow: 0 0 15px #a0aec0; }
        .histogram-bar-typist { background: linear-gradient(0deg, #48bb78, #38a169); box-shadow: 0 0 15px #48bb78; }
        .histogram-bar-speedster { background: linear-gradient(0deg, #4299e1, #3182ce); box-shadow: 0 0 15px #4299e1; }
        .histogram-bar-advanced { background: linear-gradient(0deg, #9f7aea, #805ad5); box-shadow: 0 0 15px #9f7aea; }
        .histogram-bar-legend { background: linear-gradient(0deg, #ed64a6, #d53f8c); box-shadow: 0 0 15px #ed64a6; }
        .histogram-bar-master { background: linear-gradient(0deg, #ffd700, #ffed4e); box-shadow: 0 0 20px #ffd700; animation: masterBarGlow 2s infinite; }

        @keyframes masterBarGlow {
            0%, 100% { box-shadow: 0 0 20px #ffd700; }
            50% { box-shadow: 0 0 40px #ffd700; }
        }

        .histogram-label-vertical {
            margin-top: 8px;
            font-size: 0.4em;
            color: #00f5ff;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        .histogram-value-vertical {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.5em;
            color: #ffbe0b;
            text-shadow: 0 0 5px #ffbe0b;
            white-space: nowrap;
        }

        /* CLASS STATS */
        .class-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .class-stat-card {
            background: rgba(15, 52, 96, 0.5);
            border: 3px solid #00ff87;
            border-radius: 0;
            padding: 20px;
            box-shadow: 
                6px 6px 0 rgba(0, 255, 135, 0.2),
                0 0 20px rgba(0, 255, 135, 0.3);
            transition: all 0.3s;
        }

        .class-stat-card:hover {
            transform: translate(-3px, -3px);
            box-shadow: 
                9px 9px 0 rgba(0, 255, 135, 0.3),
                0 0 30px rgba(0, 255, 135, 0.5);
        }

        .class-stat-title {
            font-size: 0.9em;
            color: #00f5ff;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 0 0 5px #00f5ff;
        }

        .class-stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 245, 255, 0.3);
            font-size: 0.6em;
        }

        .class-stat-row:last-child {
            border-bottom: none;
        }

        .class-stat-label {
            color: #ffbe0b;
        }

        .class-stat-value {
            color: #00ff87;
            text-shadow: 0 0 5px #00ff87;
        }

        .leaderboard {
            background: rgba(26, 26, 46, 0.9);
            border: 4px solid #fb5607;
            border-radius: 0;
            padding: 30px;
            box-shadow: 
                8px 8px 0 rgba(251, 86, 7, 0.3),
                0 0 50px rgba(251, 86, 7, 0.5);
        }

        .leaderboard-title {
            font-size: 1.1em;
            color: #ffbe0b;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 0 10px #ffbe0b;
            padding-bottom: 15px;
            border-bottom: 3px solid #ffbe0b;
        }

        .rank-item {
            display: grid;
            grid-template-columns: 80px 250px 1fr 160px;
            gap: 20px;
            padding: 20px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(15, 52, 96, 0.8));
            border: 3px solid #00ff87;
            border-radius: 0;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            animation: slideIn 0.5s ease-out;
            box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .rank-item:hover {
            border-color: #ff006e;
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.3), 0 0 30px rgba(255, 0, 110, 0.6);
        }

        .rank-item.top-1 {
            border: 4px solid #ffd700;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(251, 86, 7, 0.2));
            box-shadow: 6px 6px 0 rgba(255, 215, 0, 0.3), 0 0 40px rgba(255, 215, 0, 0.6);
        }

        .rank-item.top-2 {
            border: 4px solid #c0c0c0;
            background: linear-gradient(135deg, rgba(192, 192, 192, 0.2), rgba(0, 255, 135, 0.2));
        }

        .rank-item.top-3 {
            border: 4px solid #cd7f32;
            background: linear-gradient(135deg, rgba(205, 127, 50, 0.2), rgba(251, 86, 7, 0.2));
        }

        .rank-number {
            font-size: 2.5em;
            text-align: center;
            color: #00f5ff;
            text-shadow: 0 0 10px #00f5ff;
            line-height: 1;
        }

        .rank-item.top-1 .rank-number {
            color: #ffd700;
            text-shadow: 0 0 20px #ffd700;
        }

        .player-info {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .player-name {
            font-size: 1.2em;
            color: #00ff87;
            text-shadow: 0 0 5px #00ff87;
            margin-bottom: 8px;
        }

        .player-stats {
            font-size: 0.55em;
            color: #00f5ff;
        }

        .player-details {
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: 0.6em;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
        }

        .detail-label {
            color: #ffbe0b;
        }

        .detail-value {
            color: #00ff87;
            text-shadow: 0 0 5px #00ff87;
        }

        .level-badge {
            padding: 20px 15px;
            border-radius: 0;
            text-align: center;
            font-size: 0.9em;
            border: 3px solid;
            box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
            font-weight: 700;
        }

        .level-badge-wanted { background: rgba(255, 107, 107, 0.3); border-color: #ff6b6b; color: #ff6b6b; }
        .level-badge-newbie { background: rgba(160, 174, 192, 0.3); border-color: #a0aec0; color: #a0aec0; }
        .level-badge-typist { background: rgba(72, 187, 120, 0.3); border-color: #48bb78; color: #48bb78; }
        .level-badge-speedster { background: rgba(66, 153, 225, 0.3); border-color: #4299e1; color: #4299e1; }
        .level-badge-advanced { background: rgba(159, 122, 234, 0.3); border-color: #9f7aea; color: #9f7aea; }
        .level-badge-legend { background: rgba(237, 100, 166, 0.3); border-color: #ed64a6; color: #ed64a6; }
        .level-badge-master { background: rgba(255, 215, 0, 0.3); border-color: #ffd700; color: #ffd700; animation: masterGlow 2s infinite; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active { display: flex; }

        .modal-content {
            background: #0a0e27;
            border: 4px solid #ff006e;
            border-radius: 0;
            padding: 35px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 8px 8px 0 rgba(255, 0, 110, 0.5), 0 0 60px rgba(255, 0, 110, 0.8);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #ffbe0b;
        }

        .modal-title {
            font-size: 1.1em;
            color: #00ff87;
            text-shadow: 0 0 10px #00ff87;
        }

        .close-btn {
            background: linear-gradient(45deg, #ff006e, #fb5607);
            border: 3px solid #0a0e27;
            color: #fff;
            padding: 10px 20px;
            font-family: 'Press Start 2P';
            font-size: 0.55em;
            cursor: pointer;
            border-radius: 0;
            transition: all 0.3s;
            box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.5);
        }

        .close-btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: 5px 5px 0 rgba(0, 0, 0, 0.5);
        }

        .level-display {
            background: rgba(15, 52, 96, 0.5);
            border: 3px solid #00ff87;
            border-radius: 0;
            padding: 25px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 4px 4px 0 rgba(0, 255, 135, 0.2);
        }

        .level-display-title {
            font-size: 0.7em;
            color: #00f5ff;
            margin-bottom: 15px;
        }

        .level-display-badge {
            font-size: 1.5em;
            padding: 20px;
            border-radius: 0;
            border: 3px solid;
            display: inline-block;
            margin-bottom: 15px;
            box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
        }

        .stats-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            font-size: 0.65em;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-item-label {
            color: #ffbe0b;
            margin-bottom: 8px;
        }

        .stat-item-value {
            color: #00ff87;
            font-size: 1.3em;
            text-shadow: 0 0 5px #00ff87;
        }

        .chart-container {
            background: rgba(26, 26, 46, 0.8);
            border: 3px solid #00f5ff;
            border-radius: 0;
            padding: 25px;
            margin: 25px 0;
            height: 230px;
            box-shadow: 4px 4px 0 rgba(0, 245, 255, 0.2);
        }

        .test-entry {
            display: grid;
            grid-template-columns: 110px 80px 1fr 80px 80px;
            gap: 12px;
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(15, 52, 96, 0.5);
            border: 2px solid #00ff87;
            border-radius: 0;
            font-size: 0.6em;
            box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
        }

        .test-date { color: #ffbe0b; }

        .suggestion-box {
            background: linear-gradient(45deg, #ff006e, #fb5607);
            padding: 18px;
            border-radius: 0;
            margin-top: 20px;
            text-align: center;
            font-size: 0.7em;
            box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
        }

        footer {
            text-align: center;
            padding: 25px;
            margin-top: 40px;
            font-size: 0.55em;
            color: #00f5ff;
            border-top: 3px solid #00f5ff;
        }

        @media (max-width: 768px) {
            h1 { font-size: 1.5em; }
            .rank-item {
                grid-template-columns: 50px 1fr 100px;
                font-size: 0.7em;
            }
            .player-details { display: none; }
            .tab { font-size: 0.5em; padding: 10px 12px; }
            .mascot { display: none; }
            .histogram-grid { height: 300px; }
            .histogram-bar-vertical { width: 30px; }
        }
    </style>
</head>
<body>
    <!-- PIXEL ART MASCOT - ROBOT TYPIST -->
    <div class="mascot">
        <div class="robot">
            <div class="robot-antenna"></div>
            <div class="robot-head">
                <div class="robot-eye left"></div>
                <div class="robot-eye right"></div>
            </div>
            <div class="robot-body">
                <div class="robot-keyboard"></div>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>‚ö° TYPING ARENA ‚ö°</h1>
            <p class="subtitle">‚ñ∫ BIENNIO SPEED CHALLENGE ‚óÑ</p>
        </header>

        <div class="section-box">
            <div class="section-title">üéØ COME PARTECIPARE</div>
            <div class="instructions">
                <ol>
                    <li>Vai su <strong>TypingCore.com</strong></li>
                    <li>Scegli: <strong>Test 3 minuti, Italiano</strong></li>
                    <li>Fai il test e fai <strong>screenshot</strong></li>
                    <li>Manda via <strong>mail</strong>: WPM + Accuracy + Screenshot</li>
                    <li>Ripeti! <strong>Pi√π test = livello pi√π alto!</strong></li>
                </ol>
                <p><strong>‚ö° Accuracy min: 80% | üìß Oggetto: "Typing Test - [NOME]"</strong></p>
            </div>
        </div>

        <div class="section-box">
            <div class="section-title">üèÜ LIVELLI</div>
            <div class="level-legend">
                <div class="level-item level-wanted">üö® WANTED</div>
                <div class="level-item level-newbie">üê£ NEWBIE</div>
                <div class="level-item level-typist">‚å®Ô∏è TYPIST</div>
                <div class="level-item level-speedster">‚ö° SPEEDSTER</div>
                <div class="level-item level-advanced">üéì ADVANCED</div>
                <div class="level-item level-legend">üëë LEGEND</div>
                <div class="level-item level-master">üî• MASTER</div>
            </div>
        </div>

        <div class="tabs" id="tabsContainer" style="display: none;"></div>
        <div class="stats-grid" id="statsGrid"></div>
        <div id="leaderboardContainer"></div>

        <footer>
            ‚ñ≤ TYPING ARENA - BIENNIO 2025/2026 ‚ñ≤<br>
            ULTIMO AGGIORNAMENTO: <span id="lastUpdate">--</span><br>
            ü§ñ POWERED BY PROF. TREVISAN ü§ñ
        </footer>
    </div>

    <div class="modal" id="trendModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">DETTAGLI</div>
                <button class="close-btn" onclick="closeModal()">CHIUDI</button>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        let allData = [];
        let currentView = 'overall';
        let allClasses = [];

        // AUTO-LOAD CSV dalla stessa cartella all'avvio!
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                // Carica typing_data.csv dalla stessa directory
                const response = await fetch('./typing_data.csv');
                if (response.ok) {
                    const csvText = await response.text();
                    parseAndLoadCSV(csvText);
                    console.log('‚úÖ CSV caricato automaticamente!');
                } else {
                    showError('CSV non trovato nella stessa cartella.');
                }
            } catch (error) {
                showError('Errore nel caricamento del CSV: ' + error.message);
            }
        });

        function showError(message) {
            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <div class="stat-card-title">‚ö†Ô∏è ERRORE</div>
                    <div style="font-size: 0.6em; color: #ff006e; margin-top: 10px;">${message}</div>
                    <div style="font-size: 0.5em; color: #ffbe0b; margin-top: 10px;">
                        Verifica che il file typing_data.csv sia nella stessa cartella dell'HTML.
                    </div>
                </div>
            `;
        }

        function parseAndLoadCSV(csvText) {
            const lines = csvText.split('\n').filter(l => l.trim());
            allData = [];
            const classSet = new Set();

            for (let i = 1; i < lines.length; i++) {
                const parts = lines[i].split(',');
                if (parts.length < 6) continue;
                
                // Supporta sia formato vecchio (8 colonne) che nuovo (6 colonne)
                let classe, iniziali, wpm, accuracy;
                
                if (parts.length >= 8) {
                    // Formato vecchio: Data,Classe,Cognome,Nome,Iniziali,Genere,WPM,Accuracy
                    classe = parts[1].trim();
                    iniziali = parts[4].trim();
                    wpm = parseInt(parts[6]);
                    accuracy = parseInt(parts[7]);
                } else {
                    // Formato nuovo: Data,Classe,Iniziali,Genere,WPM,Accuracy
                    classe = parts[1].trim();
                    iniziali = parts[2].trim();
                    wpm = parseInt(parts[4]);
                    accuracy = parseInt(parts[5]);
                }
                
                if (!iniziali || !classe || isNaN(wpm) || wpm === 0) continue;
                if (!isNaN(accuracy) && accuracy < 80) continue;

                allData.push({ classe, iniziali, wpm, accuracy: isNaN(accuracy) ? 100 : accuracy });
                classSet.add(classe);
            }

            if (allData.length === 0) {
                showError('Nessun dato valido trovato nel CSV!');
                return;
            }

            allClasses = Array.from(classSet).sort();
            createTabs();
            renderView();
            document.getElementById('tabsContainer').style.display = 'flex';
        }

        function getGradeFromScore(score) {
            if (score < 4.5) return { level: 'üö® WANTED', badgeClass: 'level-badge-wanted', barClass: 'histogram-bar-wanted' };
            if (score < 5.5) return { level: 'üê£ NEWBIE', badgeClass: 'level-badge-newbie', barClass: 'histogram-bar-newbie' };
            if (score < 6.5) return { level: '‚å®Ô∏è TYPIST', badgeClass: 'level-badge-typist', barClass: 'histogram-bar-typist' };
            if (score < 7.5) return { level: '‚ö° SPEEDSTER', badgeClass: 'level-badge-speedster', barClass: 'histogram-bar-speedster' };
            if (score < 8.5) return { level: 'üéì ADVANCED', badgeClass: 'level-badge-advanced', barClass: 'histogram-bar-advanced' };
            if (score < 9.5) return { level: 'üëë LEGEND', badgeClass: 'level-badge-legend', barClass: 'histogram-bar-legend' };
            return { level: 'üî• MASTER', badgeClass: 'level-badge-master', barClass: 'histogram-bar-master' };
        }

        function getSpeedGrade(wpm) {
            if (wpm === 0) return 0;
            if (wpm <= 15) return 4;
            if (wpm <= 22) return 5;
            if (wpm <= 28) return 6;
            if (wpm <= 35) return 7;
            if (wpm <= 45) return 8;
            if (wpm <= 60) return 9;
            return 10;
        }

        function getConsistencyGrade(tests) {
            if (tests === 0) return 0;
            if (tests === 1) return 4;
            if (tests === 2) return 5;
            if (tests === 3) return 6;
            if (tests <= 5) return 7;
            if (tests <= 7) return 8;
            if (tests <= 10) return 9;
            return 10;
        }

        function getImprovementGrade(improvement, numTests) {
            if (numTests <= 1) return 5;
            if (improvement <= 0) return 5;
            if (improvement <= 5) return 6;
            if (improvement <= 10) return 7;
            if (improvement <= 15) return 8;
            if (improvement <= 20) return 9;
            return 10;
        }

        function createTabs() {
            let html = `
                <div class="tab active" data-view="overall">üèÜ CLASSIFICA</div>
                <div class="tab" data-view="histogram">üìä GRAFICO</div>
                <div class="tab" data-view="classstats">üìà MEDIE CLASSI</div>
            `;
            
            allClasses.forEach(cls => {
                html += `<div class="tab" data-view="${cls}">${cls}</div>`;
            });

            document.getElementById('tabsContainer').innerHTML = html;

            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    currentView = tab.dataset.view;
                    renderView();
                });
            });
        }

        function aggregateData(data) {
            const byStudent = {};
            
            data.forEach(d => {
                const key = `${d.classe}-${d.iniziali}`;
                if (!byStudent[key]) {
                    byStudent[key] = {
                        classe: d.classe,
                        iniziali: d.iniziali,
                        tests: [],
                        totalWpm: 0,
                        firstWpm: d.wpm,
                        maxWpm: d.wpm
                    };
                }
                byStudent[key].tests.push(d);
                byStudent[key].totalWpm += d.wpm;
                byStudent[key].firstWpm = Math.min(byStudent[key].firstWpm, d.wpm);
                byStudent[key].maxWpm = Math.max(byStudent[key].maxWpm, d.wpm);
            });

            return Object.values(byStudent).map(student => {
                const numTests = student.tests.length;
                const avgWpm = Math.round(student.totalWpm / numTests);
                const lastWpm = student.tests[student.tests.length - 1].wpm;
                const improvement = lastWpm - student.firstWpm;

                const speedGrade = getSpeedGrade(avgWpm);
                const consistencyGrade = getConsistencyGrade(numTests);
                const improvementGrade = getImprovementGrade(improvement, numTests);

                const finalScore = (speedGrade * 0.4) + (consistencyGrade * 0.4) + (improvementGrade * 0.2);
                const gradeInfo = getGradeFromScore(finalScore);

                return {
                    ...student,
                    avgWpm,
                    numTests,
                    improvement,
                    finalScore,
                    ...gradeInfo
                };
            });
        }

        function renderView() {
            let filtered = currentView === 'overall' || currentView === 'histogram' || currentView === 'classstats' 
                ? allData 
                : allData.filter(d => d.classe === currentView);
            
            let students = aggregateData(filtered);
            students.sort((a, b) => b.finalScore - a.finalScore);

            renderStats(students);
            
            if (currentView === 'histogram') {
                renderHistogram(students);
            } else if (currentView === 'classstats') {
                renderClassStats();
            } else {
                renderLeaderboard(students);
            }
            
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('it-IT');
        }

        function renderStats(students) {
            const totalStudents = students.length;
            const avgWpm = totalStudents > 0 ? (students.reduce((sum, s) => sum + s.avgWpm, 0) / totalStudents).toFixed(1) : 0;
            const totalTests = students.reduce((sum, s) => sum + s.numTests, 0);

            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <div class="stat-card-title">STUDENTI</div>
                    <div class="stat-card-value">${totalStudents}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">WPM MEDIO</div>
                    <div class="stat-card-value">${avgWpm}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">TEST TOTALI</div>
                    <div class="stat-card-value">${totalTests}</div>
                </div>
            `;
        }

        function renderLeaderboard(students) {
            let title = currentView === 'overall' ? 'üèÜ CLASSIFICA GENERALE' : `üéÆ CLASSIFICA ${currentView}`;
            let html = `<div class="leaderboard"><div class="leaderboard-title">${title}</div>`;

            students.forEach((s, i) => {
                const rank = i + 1;
                const topClass = rank === 1 ? 'top-1' : rank === 2 ? 'top-2' : rank === 3 ? 'top-3' : '';

                html += `
                    <div class="rank-item ${topClass}" style="animation-delay: ${i * 0.05}s" onclick="showDetails('${s.classe}', '${s.iniziali}')">
                        <div style="text-align: center;">
                            <div class="rank-number">#${rank}</div>
                            <div style="font-size: 0.5em; color: #ffbe0b; margin-top: 5px;">${s.numTests} test</div>
                        </div>
                        <div class="player-info">
                            <div class="player-name">${s.iniziali}</div>
                            <div class="player-stats">${s.classe} ‚Ä¢ ${s.avgWpm} WPM medio</div>
                        </div>
                        <div class="player-details">
                            <div class="detail-row">
                                <span class="detail-label">WPM medio</span>
                                <span class="detail-value">${s.avgWpm}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Miglioramento</span>
                                <span class="detail-value">+${s.improvement}</span>
                            </div>
                        </div>
                        <div class="level-badge ${s.badgeClass}">
                            ${s.level}
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            document.getElementById('leaderboardContainer').innerHTML = html;
        }

        function renderHistogram(students) {
            const maxWpm = Math.max(...students.map(s => s.avgWpm));
            
            let html = `
                <div class="histogram-container">
                    <div class="histogram-title">üìä GRAFICO A BARRE - WPM MEDIO</div>
                    <div class="histogram-grid">
            `;

            students.forEach((s, i) => {
                const heightPercent = (s.avgWpm / maxWpm) * 100;
                
                html += `
                    <div class="histogram-bar-vertical" onclick="showDetails('${s.classe}', '${s.iniziali}')">
                        <div class="histogram-bar-fill-vertical ${s.barClass}" style="height: ${heightPercent}%;">
                            <div class="histogram-value-vertical">${s.avgWpm}</div>
                        </div>
                        <div class="histogram-label-vertical">${s.iniziali}</div>
                    </div>
                `;
            });

            html += `
                    </div>
                </div>
            `;
            document.getElementById('leaderboardContainer').innerHTML = html;
        }

        function renderClassStats() {
            const classstats = {};
            
            allClasses.forEach(cls => {
                const classData = allData.filter(d => d.classe === cls);
                const students = aggregateData(classData);
                
                classstats[cls] = {
                    students: students.length,
                    avgWpm: students.length > 0 ? (students.reduce((sum, s) => sum + s.avgWpm, 0) / students.length).toFixed(1) : 0,
                    totalTests: students.reduce((sum, s) => sum + s.numTests, 0),
                    avgTests: students.length > 0 ? (students.reduce((sum, s) => sum + s.numTests, 0) / students.length).toFixed(1) : 0
                };
            });

            let html = `<div class="class-stats-grid">`;

            Object.keys(classstats).sort().forEach(cls => {
                const stats = classstats[cls];
                html += `
                    <div class="class-stat-card">
                        <div class="class-stat-title">${cls}</div>
                        <div class="class-stat-row">
                            <span class="class-stat-label">Studenti</span>
                            <span class="class-stat-value">${stats.students}</span>
                        </div>
                        <div class="class-stat-row">
                            <span class="class-stat-label">WPM medio</span>
                            <span class="class-stat-value">${stats.avgWpm}</span>
                        </div>
                        <div class="class-stat-row">
                            <span class="class-stat-label">Test totali</span>
                            <span class="class-stat-value">${stats.totalTests}</span>
                        </div>
                        <div class="class-stat-row">
                            <span class="class-stat-label">Test per studente</span>
                            <span class="class-stat-value">${stats.avgTests}</span>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            document.getElementById('leaderboardContainer').innerHTML = html;
        }

        function showDetails(classe, iniziali) {
            const studentTests = allData.filter(d => d.classe === classe && d.iniziali === iniziali);
            if (studentTests.length === 0) return;

            const students = aggregateData(allData);
            const s = students.find(st => st.classe === classe && st.iniziali === iniziali);

            document.getElementById('modalTitle').textContent = `${iniziali} - ${classe}`;

            let html = `
                <div class="level-display">
                    <div class="level-display-title">IL TUO LIVELLO</div>
                    <div class="level-display-badge ${s.badgeClass}">
                        ${s.level}
                    </div>
                    <div class="stats-summary">
                        <div class="stat-item">
                            <div class="stat-item-label">Test fatti</div>
                            <div class="stat-item-value">${s.numTests}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-item-label">WPM medio</div>
                            <div class="stat-item-value">${s.avgWpm}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-item-label">Miglioramento</div>
                            <div class="stat-item-value">+${s.improvement}</div>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <svg viewBox="0 0 800 200" style="width: 100%; height: 100%;">
            `;

            const maxWpm = Math.max(...studentTests.map(t => t.wpm));
            const minWpm = Math.min(...studentTests.map(t => t.wpm));
            const range = maxWpm - minWpm || 10;

            const points = studentTests.map((t, i) => {
                const x = 50 + (i * (700 / (studentTests.length - 1 || 1)));
                const y = 180 - ((t.wpm - minWpm) / range * 150);
                return `${x},${y}`;
            }).join(' ');

            html += `<polyline points="${points}" stroke="#00ff87" stroke-width="4" fill="none" filter="drop-shadow(0 0 8px #00ff87)" />`;

            studentTests.forEach((t, i) => {
                const x = 50 + (i * (700 / (studentTests.length - 1 || 1)));
                const y = 180 - ((t.wpm - minWpm) / range * 150);
                html += `
                    <circle cx="${x}" cy="${y}" r="6" fill="#ff006e" filter="drop-shadow(0 0 6px #ff006e)" />
                    <text x="${x}" y="195" text-anchor="middle" fill="#ffbe0b" font-size="10" font-family="Press Start 2P">${t.wpm}</text>
                `;
            });

            html += `</svg></div>`;

            html += '<div style="margin-top: 25px;"><div style="font-size: 0.75em; color: #00f5ff; margin-bottom: 15px; text-align: center;">üìã STORICO TEST</div>';
            studentTests.forEach((t, i) => {
                html += `
                    <div class="test-entry">
                        <div class="test-date">Test #${i + 1}</div>
                        <div style="color: #00f5ff;">Classe ${t.classe}</div>
                        <div></div>
                        <div style="font-weight: 600; color: #00ff87;">WPM: ${t.wpm}</div>
                        <div style="color: #ffbe0b;">Acc: ${t.accuracy}%</div>
                    </div>
                `;
            });
            html += '</div>';

            let suggestion = '';
            if (s.numTests < 3) {
                suggestion = `üí° Fai almeno ${3 - s.numTests} test in pi√π per salire di livello!`;
            } else if (s.finalScore < 7) {
                suggestion = 'üí° Continua ad allenarti per migliorare!';
            } else if (s.finalScore < 9) {
                suggestion = 'üí° Ottimo lavoro! Punta al livello successivo!';
            } else {
                suggestion = 'üî• FANTASTICO! Sei tra i TOP!';
            }

            html += `<div class="suggestion-box">${suggestion}</div>`;

            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('trendModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('trendModal').classList.remove('active');
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });
    </script>
</body>
</html>
